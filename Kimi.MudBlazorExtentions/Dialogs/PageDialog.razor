
@using Microsoft.AspNetCore.Components
@using MudBlazor
@typeparam TPage
@typeparam TResult

<MudDialog DefaultFocus="DefaultFocus.Element">
    <TitleContent>
        @if (!string.IsNullOrWhiteSpace(ContentText)){
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.Edit" Class="mr-3" /> @ContentText
        </MudText>
        }
    </TitleContent>
    <DialogContent>
        <!-- 级联 MudDialog 到子页面 -->
        <CascadingValue Value="MudDialog" Name="@nameof(PageDialog<object,object>)">
            <DynamicComponent Type="typeof(TPage)" Parameters="ChildParameters" />
        </CascadingValue>
    </DialogContent>

    <DialogActions>
        @if (ShowActions)
        {
            <MudButton Color="@Color" Variant="Variant.Filled" OnClick="Submit">@SubmitButtonText</MudButton>
            <MudButton OnClick="Cancel" Color="Color.Secondary">@CancelButtonText</MudButton>
        }
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter] public string ContentText { get; set; } = string.Empty;

    /// <summary>是否显示底部按钮；若页面自行关闭可设为 false。</summary>
    [Parameter] public bool ShowActions { get; set; } = true;

    [Parameter] public string SubmitButtonText { get; set; } = "Submit";
    [Parameter] public string CancelButtonText { get; set; } = "Cancel";
    [Parameter] public Color Color { get; set; } = Color.Info;

    /// <summary>传给子页面的参数字典；不强制注入任何参数。</summary>
    [Parameter] public Dictionary<string, object>? ChildParameters { get; set; }

    /// <summary>（可选）共享的外部模型；若提供，提交时将其作为结果返回。</summary>
    [Parameter] public TResult? SharedModel { get; set; }

    private void Submit()
    {
        // 若有共享模型，返回模型；否则返回“确认但无数据”
        if (SharedModel is not null)
            MudDialog.Close(DialogResult.Ok(SharedModel));
        else
            MudDialog.Close(DialogResult.Ok<object?>(null));
    }

       private void Cancel() => MudDialog.Cancel();
}